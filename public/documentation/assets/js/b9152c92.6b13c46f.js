"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[790],{2764:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"authentication/auth-system","title":"Syst\xe8me d\'Authentification","description":"Documentation compl\xe8te du syst\xe8me d\'authentification bas\xe9 sur Better Auth dans Tamagotcho.","source":"@site/docs/authentication/auth-system.md","sourceDirName":"authentication","slug":"/authentication/auth-system","permalink":"/documentation/authentication/auth-system","draft":false,"unlisted":false,"editUrl":"https://github.com/RiusmaX/tamagotcho/tree/master/documentation/docs/authentication/auth-system.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Syst\xe8me de Monstres","permalink":"/documentation/monsters/monster-system"},"next":{"title":"Vue d\'ensemble","permalink":"/documentation/cron/overview"}}');var s=i(4848),r=i(8453);const o={sidebar_position:1},l="Syst\xe8me d'Authentification",a={},c=[{value:"Vue d&#39;ensemble",id:"vue-densemble",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Configuration Server-Side",id:"configuration-server-side",level:2},{value:"Fichier: src/lib/auth.ts",id:"fichier-srclibauthts",level:3},{value:"Options de configuration",id:"options-de-configuration",level:3},{value:"Configuration Client-Side",id:"configuration-client-side",level:2},{value:"Fichier: src/lib/auth-client.ts",id:"fichier-srclibauth-clientts",level:3},{value:"Hooks et fonctions disponibles",id:"hooks-et-fonctions-disponibles",level:3},{value:"Variables d&#39;environnement",id:"variables-denvironnement",level:2},{value:"Fichier: .env.local",id:"fichier-envlocal",level:3},{value:"Configuration GitHub OAuth",id:"configuration-github-oauth",level:3},{value:"Route API d&#39;authentification",id:"route-api-dauthentification",level:2},{value:"Fichier: src/app/api/auth/[...all]/route.ts",id:"fichier-srcappapiauthallroutets",level:3},{value:"Composants de formulaires",id:"composants-de-formulaires",level:2},{value:"SignInForm",id:"signinform",level:3},{value:"SignUpForm",id:"signupform",level:3},{value:"GitHub OAuth Button",id:"github-oauth-button",level:3},{value:"Protection des routes",id:"protection-des-routes",level:2},{value:"Server-Side (Server Components)",id:"server-side-server-components",level:3},{value:"Client-Side (Client Components)",id:"client-side-client-components",level:3},{value:"Hook useSession",id:"hook-usesession",level:2},{value:"Utilisation basique",id:"utilisation-basique",level:3},{value:"Structure de l&#39;objet session",id:"structure-de-lobjet-session",level:3},{value:"Server Actions avec authentification",id:"server-actions-avec-authentification",level:2},{value:"D\xe9connexion",id:"d\xe9connexion",level:2},{value:"Bouton de d\xe9connexion",id:"bouton-de-d\xe9connexion",level:3},{value:"Collections MongoDB",id:"collections-mongodb",level:2},{value:"users",id:"users",level:3},{value:"sessions",id:"sessions",level:3},{value:"accounts",id:"accounts",level:3},{value:"S\xe9curit\xe9",id:"s\xe9curit\xe9",level:2},{value:"Meilleures pratiques",id:"meilleures-pratiques",level:3},{value:"Variables \xe0 ne JAMAIS exposer",id:"variables-\xe0-ne-jamais-exposer",level:3},{value:"Validation des formulaires",id:"validation-des-formulaires",level:2},{value:"Avec Zod (recommand\xe9)",id:"avec-zod-recommand\xe9",level:3},{value:"Gestion des erreurs",id:"gestion-des-erreurs",level:2},{value:"Tests recommand\xe9s",id:"tests-recommand\xe9s",level:2},{value:"Ressources",id:"ressources",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"syst\xe8me-dauthentification",children:"Syst\xe8me d'Authentification"})}),"\n",(0,s.jsxs)(n.p,{children:["Documentation compl\xe8te du syst\xe8me d'authentification bas\xe9 sur ",(0,s.jsx)(n.strong,{children:"Better Auth"})," dans Tamagotcho."]}),"\n",(0,s.jsx)(n.h2,{id:"vue-densemble",children:"Vue d'ensemble"}),"\n",(0,s.jsxs)(n.p,{children:["Tamagotcho utilise ",(0,s.jsx)(n.strong,{children:"Better Auth 1.3.24"}),", une solution d'authentification moderne et s\xe9curis\xe9e pour Next.js, avec support de :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Email/Password (connexion classique)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 GitHub OAuth (connexion sociale)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 MongoDB comme base de donn\xe9es"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Sessions s\xe9curis\xe9es"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Protection des routes"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        Client (Browser)                 \u2502\n\u2502  - auth-client.ts (Better Auth Client)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502 HTTP Requests\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        Server (Next.js API)             \u2502\n\u2502  - auth.ts (Better Auth Server)         \u2502\n\u2502  - API Route: /api/auth/[...all]        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502 Adapter\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        Database (MongoDB)               \u2502\n\u2502  - users collection                     \u2502\n\u2502  - sessions collection                  \u2502\n\u2502  - accounts collection                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration-server-side",children:"Configuration Server-Side"}),"\n",(0,s.jsx)(n.h3,{id:"fichier-srclibauthts",children:"Fichier: src/lib/auth.ts"}),"\n",(0,s.jsx)(n.p,{children:"Configuration de Better Auth c\xf4t\xe9 serveur."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { betterAuth } from 'better-auth'\nimport { mongodbAdapter } from 'better-auth/adapters/mongodb'\nimport { client } from '@/db'\n\nexport const auth = betterAuth({\n  database: mongodbAdapter(\n    client.db(process.env.MONGODB_DATABASE_NAME as string)\n  ),\n  emailAndPassword: {\n    enabled: true\n  },\n  socialProviders: {\n    github: {\n      enabled: true,\n      clientId: process.env.GITHUB_CLIENT_ID as string,\n      clientSecret: process.env.GITHUB_CLIENT_SECRET as string\n    }\n  }\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"options-de-configuration",children:"Options de configuration"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Option"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Valeur"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"database"})}),(0,s.jsx)(n.td,{children:"Adapter MongoDB"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mongodbAdapter(client.db(...))"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"emailAndPassword.enabled"})}),(0,s.jsx)(n.td,{children:"Activer email/password"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"true"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"socialProviders.github.enabled"})}),(0,s.jsx)(n.td,{children:"Activer GitHub OAuth"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"true"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"socialProviders.github.clientId"})}),(0,s.jsx)(n.td,{children:"ID client GitHub"}),(0,s.jsxs)(n.td,{children:["Depuis ",(0,s.jsx)(n.code,{children:".env"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"socialProviders.github.clientSecret"})}),(0,s.jsx)(n.td,{children:"Secret client GitHub"}),(0,s.jsxs)(n.td,{children:["Depuis ",(0,s.jsx)(n.code,{children:".env"})]})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"configuration-client-side",children:"Configuration Client-Side"}),"\n",(0,s.jsx)(n.h3,{id:"fichier-srclibauth-clientts",children:"Fichier: src/lib/auth-client.ts"}),"\n",(0,s.jsx)(n.p,{children:"Client d'authentification pour le navigateur."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { createAuthClient } from 'better-auth/react'\n\nexport const authClient = createAuthClient({\n  baseURL: process.env.NEXT_PUBLIC_APP_URL\n})\n\nexport const {\n  signIn,\n  signUp,\n  signOut,\n  useSession\n} = authClient\n"})}),"\n",(0,s.jsx)(n.h3,{id:"hooks-et-fonctions-disponibles",children:"Hooks et fonctions disponibles"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Fonction/Hook"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"signIn()"})}),(0,s.jsx)(n.td,{children:"Function"}),(0,s.jsx)(n.td,{children:"Connexion utilisateur"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"signUp()"})}),(0,s.jsx)(n.td,{children:"Function"}),(0,s.jsx)(n.td,{children:"Inscription utilisateur"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"signOut()"})}),(0,s.jsx)(n.td,{children:"Function"}),(0,s.jsx)(n.td,{children:"D\xe9connexion"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"useSession()"})}),(0,s.jsx)(n.td,{children:"Hook"}),(0,s.jsx)(n.td,{children:"R\xe9cup\xe8re la session active"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"variables-denvironnement",children:"Variables d'environnement"}),"\n",(0,s.jsx)(n.h3,{id:"fichier-envlocal",children:"Fichier: .env.local"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# MongoDB\nMONGODB_URI="mongodb+srv://..."\nMONGODB_DATABASE_NAME="tamagotcho"\n\n# Better Auth\nNEXT_PUBLIC_APP_URL="http://localhost:3000"\n\n# GitHub OAuth (optionnel)\nGITHUB_CLIENT_ID="your_github_client_id"\nGITHUB_CLIENT_SECRET="your_github_client_secret"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-github-oauth",children:"Configuration GitHub OAuth"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cr\xe9er une OAuth App sur GitHub"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Aller sur ",(0,s.jsx)(n.a,{href:"https://github.com/settings/developers",children:"GitHub Settings > Developer settings > OAuth Apps"})]}),"\n",(0,s.jsx)(n.li,{children:'Cliquer sur "New OAuth App"'}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Remplir les informations"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Application name"}),": Tamagotcho"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Homepage URL"}),": ",(0,s.jsx)(n.code,{children:"http://localhost:3000"})," (dev) ou votre URL de production"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authorization callback URL"}),": ",(0,s.jsx)(n.code,{children:"http://localhost:3000/api/auth/callback/github"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"R\xe9cup\xe9rer les credentials"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Copier le ",(0,s.jsx)(n.strong,{children:"Client ID"})]}),"\n",(0,s.jsxs)(n.li,{children:["G\xe9n\xe9rer et copier le ",(0,s.jsx)(n.strong,{children:"Client Secret"})]}),"\n",(0,s.jsxs)(n.li,{children:["Ajouter dans ",(0,s.jsx)(n.code,{children:".env.local"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"route-api-dauthentification",children:"Route API d'authentification"}),"\n",(0,s.jsx)(n.h3,{id:"fichier-srcappapiauthallroutets",children:"Fichier: src/app/api/auth/[...all]/route.ts"}),"\n",(0,s.jsx)(n.p,{children:"Route catch-all pour g\xe9rer toutes les requ\xeates d'authentification."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { auth } from '@/lib/auth'\nimport { toNextJsHandler } from 'better-auth/next-js'\n\nexport const { GET, POST } = toNextJsHandler(auth)\n"})}),"\n",(0,s.jsxs)(n.admonition,{title:"Routes g\xe9n\xe9r\xe9es automatiquement",type:"info",children:[(0,s.jsx)(n.p,{children:"Better Auth g\xe9n\xe8re automatiquement les routes suivantes :"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST /api/auth/sign-in"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST /api/auth/sign-up"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST /api/auth/sign-out"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"GET /api/auth/callback/github"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"GET /api/auth/session"})}),"\n"]})]}),"\n",(0,s.jsx)(n.h2,{id:"composants-de-formulaires",children:"Composants de formulaires"}),"\n",(0,s.jsx)(n.h3,{id:"signinform",children:"SignInForm"}),"\n",(0,s.jsx)(n.p,{children:"Formulaire de connexion avec email/password."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"'use client'\n\nimport { useState } from 'react'\nimport { signIn } from '@/lib/auth-client'\nimport { Button, Input } from '@/components'\n\nexport function SignInForm() {\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n\n    try {\n      await signIn.email({\n        email,\n        password,\n        callbackURL: '/dashboard'\n      })\n    } catch (error) {\n      console.error('Erreur de connexion:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <Input\n        type=\"email\"\n        placeholder=\"Email\"\n        value={email}\n        onChange={(e) => setEmail(e.target.value)}\n        required\n      />\n      <Input\n        type=\"password\"\n        placeholder=\"Mot de passe\"\n        value={password}\n        onChange={(e) => setPassword(e.target.value)}\n        required\n      />\n      <Button type=\"submit\" disabled={loading}>\n        {loading ? 'Connexion...' : 'Se connecter'}\n      </Button>\n    </form>\n  )\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"signupform",children:"SignUpForm"}),"\n",(0,s.jsx)(n.p,{children:"Formulaire d'inscription."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"'use client'\n\nimport { useState } from 'react'\nimport { signUp } from '@/lib/auth-client'\nimport { Button, Input } from '@/components'\n\nexport function SignUpForm() {\n  const [name, setName] = useState('')\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n\n    try {\n      await signUp.email({\n        name,\n        email,\n        password,\n        callbackURL: '/dashboard'\n      })\n    } catch (error) {\n      console.error('Erreur d\\'inscription:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <Input\n        type=\"text\"\n        placeholder=\"Nom\"\n        value={name}\n        onChange={(e) => setName(e.target.value)}\n        required\n      />\n      <Input\n        type=\"email\"\n        placeholder=\"Email\"\n        value={email}\n        onChange={(e) => setEmail(e.target.value)}\n        required\n      />\n      <Input\n        type=\"password\"\n        placeholder=\"Mot de passe\"\n        value={password}\n        onChange={(e) => setPassword(e.target.value)}\n        required\n      />\n      <Button type=\"submit\" disabled={loading}>\n        {loading ? 'Inscription...' : 'S\\'inscrire'}\n      </Button>\n    </form>\n  )\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"github-oauth-button",children:"GitHub OAuth Button"}),"\n",(0,s.jsx)(n.p,{children:"Bouton de connexion via GitHub."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"'use client'\n\nimport { signIn } from '@/lib/auth-client'\nimport { Button } from '@/components'\n\nexport function GitHubSignInButton() {\n  const handleGitHubSignIn = async () => {\n    await signIn.social({\n      provider: 'github',\n      callbackURL: '/dashboard'\n    })\n  }\n\n  return (\n    <Button onClick={handleGitHubSignIn} variant=\"outline\">\n      <GitHubIcon /> Continuer avec GitHub\n    </Button>\n  )\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"protection-des-routes",children:"Protection des routes"}),"\n",(0,s.jsx)(n.h3,{id:"server-side-server-components",children:"Server-Side (Server Components)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { auth } from '@/lib/auth'\nimport { redirect } from 'next/navigation'\n\nexport default async function DashboardPage() {\n  const session = await auth()\n\n  if (!session?.user) {\n    redirect('/sign-in')\n  }\n\n  return (\n    <div>\n      <h1>Bienvenue {session.user.name}</h1>\n      {/* Contenu prot\xe9g\xe9 */}\n    </div>\n  )\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"client-side-client-components",children:"Client-Side (Client Components)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"'use client'\n\nimport { useSession } from '@/lib/auth-client'\nimport { redirect } from 'next/navigation'\nimport { useEffect } from 'react'\n\nexport function ProtectedComponent() {\n  const { data: session, isPending } = useSession()\n\n  useEffect(() => {\n    if (!isPending && !session) {\n      redirect('/sign-in')\n    }\n  }, [session, isPending])\n\n  if (isPending) {\n    return <div>Chargement...</div>\n  }\n\n  return (\n    <div>\n      <p>Contenu prot\xe9g\xe9 pour {session.user.name}</p>\n    </div>\n  )\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"hook-usesession",children:"Hook useSession"}),"\n",(0,s.jsx)(n.h3,{id:"utilisation-basique",children:"Utilisation basique"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"'use client'\n\nimport { useSession } from '@/lib/auth-client'\n\nexport function UserProfile() {\n  const { data: session, isPending } = useSession()\n\n  if (isPending) {\n    return <div>Chargement...</div>\n  }\n\n  if (!session) {\n    return <div>Non connect\xe9</div>\n  }\n\n  return (\n    <div>\n      <img src={session.user.image} alt={session.user.name} />\n      <h2>{session.user.name}</h2>\n      <p>{session.user.email}</p>\n    </div>\n  )\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"structure-de-lobjet-session",children:"Structure de l'objet session"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface Session {\n  user: {\n    id: string\n    name: string\n    email: string\n    image?: string\n  }\n  expiresAt: Date\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"server-actions-avec-authentification",children:"Server Actions avec authentification"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"'use server'\n\nimport { auth } from '@/lib/auth'\nimport { MonsterModel } from '@/db/models/monster.model'\n\nexport async function createMonster(name: string) {\n  // V\xe9rification de l'authentification\n  const session = await auth()\n  \n  if (!session?.user?.id) {\n    throw new Error('Non authentifi\xe9')\n  }\n\n  // Action prot\xe9g\xe9e\n  const monster = await MonsterModel.create({\n    name,\n    ownerId: session.user.id,\n    // ...\n  })\n\n  return monster\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"d\xe9connexion",children:"D\xe9connexion"}),"\n",(0,s.jsx)(n.h3,{id:"bouton-de-d\xe9connexion",children:"Bouton de d\xe9connexion"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"'use client'\n\nimport { signOut } from '@/lib/auth-client'\nimport { Button } from '@/components'\n\nexport function SignOutButton() {\n  const handleSignOut = async () => {\n    await signOut({\n      callbackURL: '/'\n    })\n  }\n\n  return (\n    <Button onClick={handleSignOut} variant=\"ghost\">\n      Se d\xe9connecter\n    </Button>\n  )\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"collections-mongodb",children:"Collections MongoDB"}),"\n",(0,s.jsx)(n.p,{children:"Better Auth cr\xe9e automatiquement les collections suivantes :"}),"\n",(0,s.jsx)(n.h3,{id:"users",children:"users"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "_id": "ObjectId",\n  "name": "John Doe",\n  "email": "john@example.com",\n  "emailVerified": false,\n  "image": "https://...",\n  "createdAt": "2024-01-01T00:00:00.000Z",\n  "updatedAt": "2024-01-01T00:00:00.000Z"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"sessions",children:"sessions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "_id": "ObjectId",\n  "userId": "user_id",\n  "expiresAt": "2024-02-01T00:00:00.000Z",\n  "token": "session_token",\n  "ipAddress": "192.168.1.1",\n  "userAgent": "Mozilla/5.0..."\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"accounts",children:"accounts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "_id": "ObjectId",\n  "userId": "user_id",\n  "providerId": "github",\n  "providerUserId": "github_user_id",\n  "accessToken": "...",\n  "refreshToken": "..."\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"s\xe9curit\xe9",children:"S\xe9curit\xe9"}),"\n",(0,s.jsx)(n.h3,{id:"meilleures-pratiques",children:"Meilleures pratiques"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Jamais de secrets c\xf4t\xe9 client"})," : ",(0,s.jsx)(n.code,{children:"GITHUB_CLIENT_SECRET"})," uniquement dans ",(0,s.jsx)(n.code,{children:".env.local"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"HTTPS en production"})," : Toujours utiliser HTTPS pour les requ\xeates d'auth"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Validation serveur"})," : Toujours v\xe9rifier la session c\xf4t\xe9 serveur"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Expiration de session"})," : Sessions expir\xe9es automatiquement"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Protection CSRF"})," : G\xe9r\xe9e automatiquement par Better Auth"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"variables-\xe0-ne-jamais-exposer",children:"Variables \xe0 ne JAMAIS exposer"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u274c NE JAMAIS pr\xe9fixer avec NEXT_PUBLIC_\nGITHUB_CLIENT_SECRET="secret"\nMONGODB_URI="mongodb+srv://..."\n\n# \u2705 OK pour le client\nNEXT_PUBLIC_APP_URL="https://..."\n'})}),"\n",(0,s.jsx)(n.h2,{id:"validation-des-formulaires",children:"Validation des formulaires"}),"\n",(0,s.jsx)(n.h3,{id:"avec-zod-recommand\xe9",children:"Avec Zod (recommand\xe9)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { z } from 'zod'\n\nconst signUpSchema = z.object({\n  name: z.string().min(2, 'Le nom doit contenir au moins 2 caract\xe8res'),\n  email: z.string().email('Email invalide'),\n  password: z.string().min(8, 'Le mot de passe doit contenir au moins 8 caract\xe8res')\n})\n\nexport function SignUpForm() {\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault()\n    \n    // Validation\n    const result = signUpSchema.safeParse({ name, email, password })\n    \n    if (!result.success) {\n      console.error(result.error.errors)\n      return\n    }\n    \n    // Inscription\n    await signUp.email(result.data)\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"gestion-des-erreurs",children:"Gestion des erreurs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"'use client'\n\nimport { useState } from 'react'\nimport { signIn } from '@/lib/auth-client'\n\nexport function SignInForm() {\n  const [error, setError] = useState<string | null>(null)\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault()\n    setError(null)\n\n    try {\n      await signIn.email({ email, password })\n    } catch (err) {\n      if (err instanceof Error) {\n        setError(err.message)\n      } else {\n        setError('Une erreur est survenue')\n      }\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit}>\n      {error && <div className=\"error\">{error}</div>}\n      {/* Champs de formulaire */}\n    </form>\n  )\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"tests-recommand\xe9s",children:"Tests recommand\xe9s"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"describe('Authentication', () => {\n  it('devrait connecter un utilisateur valide', async () => {\n    const result = await signIn.email({\n      email: 'test@example.com',\n      password: 'password123'\n    })\n    \n    expect(result.user).toBeDefined()\n    expect(result.user.email).toBe('test@example.com')\n  })\n\n  it('devrait rejeter un mot de passe invalide', async () => {\n    await expect(\n      signIn.email({\n        email: 'test@example.com',\n        password: 'wrong'\n      })\n    ).rejects.toThrow()\n  })\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ressources",children:"Ressources"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.better-auth.com",children:"Better Auth Documentation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/settings/developers",children:"GitHub OAuth Apps"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://nextjs.org/docs/app/building-your-application/authentication",children:"Next.js Authentication"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.better-auth.com/docs/adapters/mongodb",children:"MongoDB Adapter"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var t=i(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);